require("dotenv").config();const{getContactById:getContactById}=require("../db.repository/contacts.repository"),{SESSION_ID:SESSION_ID}=process.env,{signalRClient:signalRClient,serverHub:serverHub}=require("../signalr/signalr.util"),incomingCall=async(e,n)=>{const t=Object.values(e)[0];if(t){const{id:e,from:i,isVideo:o}=t;let s=void 0;try{s=await getContactById(i)}catch(e){console.log(`getContactById::ex: ${e}`)}const a=n,r={id:e,sessionId:SESSION_ID,type:"call_log",from:i||"",to:a||"",sender:{id:s.id?s.id:"",name:s.name?s.name:"",shortName:"",pushname:""},unixTimestamp:Math.floor((new Date).getTime()/1e3)};signalRClient.connection.hub.invoke(serverHub,"ReceiveMessage",JSON.stringify({message:r,sessionId:SESSION_ID}))}};module.exports=incomingCall;