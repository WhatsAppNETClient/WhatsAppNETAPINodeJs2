const vcardToJSON=e=>{const t={},i=e.split("\n");for(const e of i){const[i,a]=e.split(":");"BEGIN"!==i&&"END"!==i&&"PHOTO;BASE64"!==i&&("VERSION"===i&&(t.version=a),"N"===i&&(t.n=a),"FN"===i&&(t.fn=a),"ORG"===i&&(t.org=a),"TITLE"===i&&(t.title=a),i.toLowerCase().indexOf("waid")>=0&&(t.waid=a),"TEL;type=Work"===i&&(t.telWork=a),"TEL;type=Home"===i&&(t.telHome=a),"EMAIL;TYPE=Work"===i&&(t.emailWork=a),"EMAIL;TYPE=Home"===i&&(t.emailHome=a),i.indexOf("ADR;type=Work")>=0&&(t.adrWork=a),i.indexOf("ADR;type=Home")>=0&&(t.adrHome=a))}return t},keyExist=(e,t)=>{try{if(e[t])return e[t];for(const i in e)if("object"==typeof e[i]){if(keyExist(e[i],t))return!0}}catch(e){}return!1},findVal=(e,t)=>{try{if(e[t])return e[t];for(const i in e)if("object"==typeof e[i]){const a=findVal(e[i],t);if(a)return a}}catch(e){}},isUrl=e=>/^(?:\w+:)?\/\/([^\s\.]+\.\S{2}|localhost[\:?\d]*)\S*$/.test(e),isImage=e=>"image"===e.split("/")[0],isVideo=e=>"video"===e.split("/")[0],isAudio=e=>"audio"===e.split("/")[0],waitFor=e=>new Promise(t=>setTimeout(t,e)),asyncForEach=async(e,t)=>{for(let i=0;i<e.length;i++)await t(e[i],i,e)},msgContent=(e,t)=>{let i=void 0;try{switch(e){case"chat":if(!(i=findVal(t,"conversation"))){const e=findVal(t,"extendedTextMessage");e&&(i=e.text)}break;case"image":i=findVal(t,"caption");break;case"document":i=findVal(t,"title");break;case"location":i=findVal(t,"name");break;case"button":if(!(i=findVal(t,"caption"))){(keyExist(t,"urlButton")||keyExist(t,"callButton")||keyExist(t,"quickReplyButton"))&&(i=findVal(t,"hydratedContentText"))}break;case"buttons_response":i=findVal(t,"selectedDisplayText");break;case"list":i=findVal(t,"description");break;case"list_response":i=findVal(t,"title");break;case"vcard":case"multi_vcard":i=findVal(t,"displayName");break;case"video":i=findVal(t,"caption")}}catch(e){}return i},validateJid=e=>{let t=void 0;try{const i=e.split("@"),a=i[0],o=i[1];t=`${a.indexOf(":")>=0?a.split(":")[0]:a}@${o}`}catch(e){console.log(`validateJid::ex: ${e}`)}return t};module.exports={vcardToJSON:vcardToJSON,keyExist:keyExist,findVal:findVal,isUrl:isUrl,isImage:isImage,isVideo:isVideo,isAudio:isAudio,msgContent:msgContent,waitFor:waitFor,asyncForEach:asyncForEach,validateJid:validateJid};